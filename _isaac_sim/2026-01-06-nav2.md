---
title: "Nav2 Navigate to Pose"
collection: isaac_sim
date: 2026-01-06
permalink: /isaac-sim/nav2-guide/
excerpt: "Nav2가 구독/발행하는 토픽, TF 요구사항, 핵심 노드, 타임스탬프 동기화와 디버깅 팁 정리."
---

## Nav2 Navigate to Pose 완전 가이드

### Nav2가 구독하는 Topic

| Topic | 타입 | 설명 |
|-------|------|------|
| `/scan` | `sensor_msgs/LaserScan` | LiDAR 데이터 |
| `/odom` | `nav_msgs/Odometry` | 로봇 주행거리 |
| `/tf` | `tf2_msgs/TFMessage` | 좌표계 변환 (필수!) |
| `/map` | `nav_msgs/OccupancyGrid` | 지도 |
| `/goal_pose` | `geometry_msgs/PoseStamped` | 목표 위치 |

### Nav2가 발행하는 Topic

| Topic | 타입 | 설명 |
|-------|------|------|
| `/cmd_vel` | `geometry_msgs/Twist` | 로봇 속도 명령 |
| `/plan` | `nav_msgs/Path` | 계획된 경로 |

### 필요한 TF (좌표 변환)

```
map → odom → base_link → [sensors]
```

### 디버깅 체크리스트

```bash
# 필수 Topic 확인
ros2 topic list | grep -E "scan|odom|tf|map|cmd_vel"

# TF 트리 확인
ros2 run tf2_tools view_frames

# Timestamp 확인
ros2 topic echo /scan --field header.stamp
ros2 topic echo /odom --field header.stamp
```

## 실습: Nav2 실행 예제

아래 예제는 기본적인 Nav2 bringup을 시뮬레이터나 실제 로봇에서 실행할 때 참고할 수 있는 명령어들입니다. 실제 패키지명·런치 파일명·파라미터 파일 위치는 환경(시뮬레이터, 로봇)에 따라 달라지므로 리포지토리의 런치 파일/파라미터 파일을 확인하세요.

```bash
# 예: Nav2 bringup (example - 패키지와 런치 파일명은 환경에 따라 다름)
ros2 launch nav2_bringup nav2_bringup_launch.py \
	params_file:=./nav2_params.yaml \
	map:=./map.yaml \
	use_sim_time:=true

# AMCL (로컬라이제이션) 실행 예
ros2 launch nav2_amcl amcl_launch.py map:=./map.yaml use_sim_time:=true

# Map server (맵 서버) 실행
ros2 run nav2_map_server map_server --ros-args -p yaml_filename:=./map.yaml
```

`use_sim_time:=true`를 사용하면 시뮬레이터(예: Isaac Sim)가 발행하는 `/clock` 토픽을 사용하도록 Nav2와 노드들이 동작합니다. Isaac Sim에서 ROS2 Clock을 퍼블리시하도록 설정되어야 합니다.

## TF / Timestamp 디버깅 상세

- Extrapolation Error (TF lookup 실패 또는 시간 차이 관련)
	- 원인: `/tf` 트리에서 요청한 시점의 변환이 존재하지 않거나, 센서 메시지 타임스탬프와 TF가 서로 다른 타임스탬프를 사용함.
	- 해결:
		- 모든 노드에서 `use_sim_time`을 동일하게 설정(시뮬레이터 사용시 필수).
		- TF 발행자(예: robot_state_publisher)가 올바른 frame_id를 사용하고 있는지 확인.
		- `ros2 topic echo /tf` 또는 `ros2 run tf2_tools view_frames`로 TF 트리를 시각화해 누락된 프레임 확인.

- TF 시간 불일치가 의심될 때 빠른 테스트:
	```bash
	# 센서 메시지의 헤더 타임스탬프와 TF를 비교
	ros2 topic echo /scan --field header.stamp
	ros2 topic echo /tf

	# 임시로 static transform 발행(디버깅용)
	ros2 run tf2_ros static_transform_publisher 0 0 0 0 0 0 map odom 100
	```

## 자주 보는 오류와 해결 요약

- `[controller_server]: Extrapolation Error looking up robot pose` → 시간 동기화 또는 TF 누락 문제.
- `[amcl]: Could not transform laser scan at time X` → `use_sim_time` 확인, 센서와 TF의 timestamp 동기화 확인.
- `TF timeout waiting for transform` → TF 발행자(예: robot_state_publisher)가 정상 실행 중인지, 프레임 이름이 맞는지 확인.

## 추가 유틸리티 & 팁

- 실시간 토픽/메시지 검사
	```bash
	ros2 topic hz /cmd_vel
	ros2 topic echo /odom
	ros2 topic list
	```

- 전체 토픽/노드 상태 확인
	```bash
	ros2 node list
	ros2 topic list
	```

- 문제 재현을 위해 bag 기록
	```bash
	ros2 bag record -a -o my_run
	```

## 권장 검사 순서 (문제가 발생했을 때)
1. `ros2 topic list`로 필요한 토픽(특히 `/scan`, `/odom`, `/tf`, `/map`) 존재 확인
2. `ros2 topic echo <topic>`로 메시지 타임스탬프가 정상인지 확인
3. `ros2 run tf2_tools view_frames`로 TF 트리 시각화
4. Nav2 로그(launch 콘솔 출력)에서 `Extrapolation` 또는 `Transform` 관련 에러 확인
5. `use_sim_time` 설정과 시뮬레이터의 `/clock` 퍼블리시 여부 확인

---

## 참고 자료

- Isaac Sim 공식 문서: https://docs.omniverse.nvidia.com/isaacsim/
- Nav2 공식 문서: https://navigation.ros.org/
- ROS2 공식 문서: https://docs.ros.org/en/humble/
