---
title: "📓 2025-12-11 자세한 ESP32 Devlog"
short_title: "ESP32 Devlog"
collection: arduino
permalink: /arduino/2025-12-11-esp32-devlog/
date: 2025-12-11
excerpt: "ESP32 초기 실험: 회로 구성, PWM 제어, WebServer 간단 구현, 그리고 서보 모터와 레이저의 동시 운용 실험"
read_time: true
share: true
---

# 시작

오늘은 ESP32의 I/O 특성과 외부 장치(서보, 레이저, 센서)의 전원 및 신호 레벨을 확인하고자 했다. 특히, **3.3V VS 5V 라인**의 혼동으로 인한 고장 위험을 줄이는 데 초점을 맞췄다.

## 실험 목표

1. ESP32에서 서보 제어 (PWM) 및 서보 동작 확인
2. 레이저 모듈 ON/OFF 동작 확인
3. 간단한 HTTP Server 구현으로 원격 제어

## 구성

- ESP32 Dev Board
- MG90S Test Servo (예비)
- KY-008 레이저 모듈 (예비)
- Breadboard / 점퍼선
- 외부 5V 전원

## 문제 및 해결

- PWM이 소프트웨어적으로는 출력됐으나 서보 움직임이 미미: 외부 5V 공급을 적용하여 해결
- 레이저 깜박임: 신호핀의 전압 레벨(3.3V)을 확인하고, KY-008의 전원 분리로 안정화

## 메모

- ESP32의 3.3V I/O로 인해 5V 모듈 제어 시 전원 경로를 반드시 분리해야 함
- 장기적인 설계: MOSFET/트랜지스터를 사용해 5V 모듈을 드라이브하는 것이 안전

## 다음 작업

1. MG90S를 사용한 내구성 테스트
2. 전원 전용 회로(필터, 레귤레이터) 도입
3. Web UI 개선 (토글 버튼, 피드백 표시)
---

## 🎯 목표

- **노트북 없이**
- **보조배터리 전원**
- **Wi-Fi로 ESP32 접속**
- **브라우저에서 서보 + 레이저 ON/OFF 제어**

---

## 1️⃣ 초반: 아두이노 + USB + FastAPI

### 했던 것

- Arduino Uno + 서보 + 레이저
- FastAPI → USB Serial로 제어
- Boolean 값으로 ON/OFF 구조 설계

### 문제

- USB 의존
- 블루투스 시도 → **연결 즉시 끊김**
- HC-06 전압/저항/TX-RX/드라이버 등 삽질

### 결론

- **블루투스는 전원/안정성/환경 변수 많음**
- 이 프로젝트엔 부적합

---

## 2️⃣ ESP32로 전환 (큰 분기점)

### 선택

- ESP32 Dev Module 도입
- “아두이노 대신 이걸로 한 방에 가자”

### 초반 문제

- 업로드 실패
- `/dev/ttyACM*` / `/dev/ttyUSB*` 헷갈림
- BOOT 버튼 타이밍 몰라서 업로드 실패

### 해결

- **BOOT(IO0) 버튼 누른 채 업로드**
- 업로드 성공 → 시리얼 로그 정상

---

## 3️⃣ Wi-Fi 연결 성공

### 첫 성공 로그

```
WiFi connected
IP address: 192.168.10.15

```

### 깨달음

- **ESP32 자체 웹서버(WebServer.h)** 가 훨씬 단순
- FastAPI 굳이 중간에 안 껴도 됨

---

## 4️⃣ 웹으로 제어 성공 🎉

### 구현

- `/laser/on`, `/laser/off`
- `/servo/on`, `/servo/off`

### 결과

- 브라우저에서 직접 제어 성공
- 노트북 없어도 작동 (조건: 전원 안정)

---

## 5️⃣ 전원 지옥 🔥 (오늘의 핵심 교훈)

### 겪은 증상

- Wi-Fi 연결됐다가 안 됨
- 보조배터리에서 안 붙음
- 레이저 깜빡임
- ESP32 리셋 로그 반복

### 원인 발견

### ❌ USB-C ↔ USB-C (C-to-C)

- PD 협상 필요
- ESP32는 PD 미지원
- 전압/전류 불안정

### ✅ USB-A → USB-C (A-to-C)

- 무조건 5V 공급
- Wi-Fi/웹서버 완전 안정

👉 **설명서에 “C-to-C 안 됨” 써있던 이유 체감**

---

## 6️⃣ 고정 IP 설정

### 문제

- IP 바뀌면 매번 다시 확인해야 함

### 해결

- `WiFi.config()`로 **Static IP 적용**

```
IPAddress local_IP(192,168,10,50);

```

### 결과

- 전원 껐다 켜도 IP 고정
- 장비 느낌 확 남

---

## 7️⃣ 서보 제어 코드 개선

### 초기

- `delay()` 기반 왕복
- 웹 요청 중간에 씹힘

### 개선

- `millis()` 기반 토글
- 웹서버 항상 응답

👉 **ESP32에서는 delay 금기**

---

## 8️⃣ 레이저(HW-493) 깜빡임 이슈

### 상황

- 레이저만 연결했는데도 깜빡임

### 추정 원인 후보

1. **VCC를 3.3V에 연결했을 가능성**
2. GND 기준 불안정
3. 모듈 자체가 Active-LOW or 전원 민감
4. 저가형 모듈 품질 이슈

### 현재 상태

- **레이저 단독 테스트 필요**
- S선 분리 + VCC/GND만으로 안정성 확인 예정

---

## 9️⃣ 최종 현재 상태 (오늘 기준)

### ✅ 된 것

- ESP32 업로드
- Wi-Fi 연결
- 웹서버 동작
- 브라우저 제어
- 서보 동작
- 전원 문제 원인 정확히 파악

### ⚠ 남은 것

- HW-493 레이저 전원 안정화
- 배선 최종 정리
- 케이스/실사용 구조

---

## 🧠 오늘의 핵심 교훈 TOP 5

1. **USB-C는 다 같은 USB-C가 아니다**
2. MCU는 **멍청한 5V**를 좋아한다
3. ESP32 + Wi-Fi = 전원 품질이 절반
4. `delay()`는 웹서버의 적
5. 설명서에 적힌 “안 됨”은 다 이유가 있다

---

## 🎯 다음 액션 아이템

- [ ]  레이저 VCC를 VIN(5V)에 확정
- [ ]  레이저 단독 고정출력 테스트
- [ ]  서보 + 레이저 전원 분리 여부 결정
- [ ]  FastAPI → ESP32 HTTP 연동
- [ ]  YOLO 트리거 연계

*** End Patch